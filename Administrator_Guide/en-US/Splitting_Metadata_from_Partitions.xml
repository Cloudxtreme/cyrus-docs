<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "Administrator_Guide.ent">
%BOOK_ENTITIES;
]>
<chapter id="chap-Administrator_Guide-Splitting_Metadata_from_Partitions">
    <title>Splitting Metadata from Partitions</title>
    <para>
        The traditional layout for a Cyrus IMAP version &PRODUCT_VERSION; mailbox spool directory is to include the mailbox message data and mailbox metadata in the same directory tree. The mailbox message data and mailbox metadata differ in size and frequency of updating, which in larger deployments may justify using different storage layers for each.
    </para>
    <para>
        The mailbox message data, which consists of many (small) message files, is not updated as frequently and does not require as much storage performance as the mailbox metadata, which consists of databases that are updated frequently and have a high volume of accesses and updates. The mailbox message data usually requires significant storage volumes, while the mailbox metadata does not.
    </para>
    <para>
        To transition from the traditional Cyrus IMAP version &PRODUCT_VERSION; mailbox spool directory tree layout to a split setup, use
    </para>
    <procedure id="proc-Administrator_Guide-Splitting_Metadata_from_Partitions-Transition_from_Traditional_Mail_Spool_to_Split_Data_Mail_Spool">
        <title>Transition from Traditional Mail Spool to Split Data Mail Spool</title>
        <step>
            <para>
                Create a new partition in <filename>/etc/imapd.conf</filename>, aptly named <literal>splitmeta</literal> in the following example configuration snippet:
            </para>
            <para>
                <example id="exam-Administrator_Guide-Transition_from_Traditional_Mail_Spool_to_Split_Data_Mail_Spool-Example_Split_Metadata_Mail_Spool_Configuration_Snippet">
                    <title>Example Split Metadata Mail Spool Configuration Snippet</title>
                    <para>

<screen>metapartition_files: header index cache expunge squat
metapartition-default: /var/spool/imap
metapartition-splitmeta: /var/spool/splitmeta/metadata
partition-default: /var/spool/imap
partition-splitmeta: /var/spool/splitmeta/partition</screen>

                    </para>

                </example>

            </para>

        </step>
        <step>
            <para>
                Create the directory tree being referred to in the new configuration:
            </para>
            <para>

<screen># su -s /bin/bash - cyrus -c '/usr/lib/cyrus-imapd/mkimap /etc/imapd.conf'</screen>

            </para>

        </step>
        <step>
            <para>
                Reload the Cyrus IMAP service. Please refer to <xref linkend="chap-Administrator_Guide-Reloading_Cyrus_IMAP_Services" /> for more details on doing so.
            </para>

        </step>
        <step>
            <para>
                Rename all mailboxes, using the new partition as the location for the renamed mailbox. One example rename command is included below:
            </para>
            <para>

<screen>cyradm&gt; <userinput>renamemailbox user/john.doe@example.org user/john.doe@example.org splitmeta</userinput></screen>

            </para>

        </step>

    </procedure>


</chapter>

