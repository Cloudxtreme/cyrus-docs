<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Mailbox Creation Distribution &mdash; Cyrus IMAP and SASL 2.4 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/extra.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Cyrus IMAP and SASL 2.4 documentation" href="../index.html" />
    <link rel="up" title="Deployment Guide" href="index.html" />
    <link rel="next" title="Known Protocol Limitations" href="known_protocol_limitations.html" />
    <link rel="prev" title="Deployment Scenarios" href="deployment_scenarios.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="known_protocol_limitations.html" title="Known Protocol Limitations"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="deployment_scenarios.html" title="Deployment Scenarios"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Cyrus IMAP and SASL 2.4 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Deployment Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="mailbox-creation-distribution">
<h1>Mailbox Creation Distribution<a class="headerlink" href="#mailbox-creation-distribution" title="Permalink to this headline">¶</a></h1>
<div class="section" id="on-backend">
<h2>On backend<a class="headerlink" href="#on-backend" title="Permalink to this headline">¶</a></h2>
<p>Upon creating a user mailbox, if the target partition is not given as extra parameter, the mailbox is either created on</p>
<ul class="simple">
<li>the configured <tt class="docutils literal"><span class="pre">defaultpartition</span></tt></li>
<li>the most fitting partition if <tt class="docutils literal"><span class="pre">defaultpartition</span></tt> is not configured</li>
</ul>
</div>
<div class="section" id="selection-mode">
<h2>Selection Mode<a class="headerlink" href="#selection-mode" title="Permalink to this headline">¶</a></h2>
<p>Among the partitions, how the most fitting one is selected depends on the configured selection mode: <tt class="docutils literal"><span class="pre">partition_mode</span></tt> setting in <tt class="docutils literal"><span class="pre">/etc/imapd.conf</span></tt></p>
<div class="section" id="available-selection-modes-on-backend">
<h3>Available Selection Modes on Backend<a class="headerlink" href="#available-selection-modes-on-backend" title="Permalink to this headline">¶</a></h3>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">See if this is the same as the section in the administrator guide - if so, just link there?</p>
</div>
<ul>
<li><p class="first">random</p>
<blockquote>
<div><p>Choice is (pseudo-)random. Each partition has the same probability of being selected.</p>
</div></blockquote>
</li>
<li><p class="first">freespace-most</p>
<blockquote>
<div><p>The partition which has the most free space (counted in KiB units) is selected.</p>
</div></blockquote>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Example of ``freespace-most`` Selection on Backend</strong></p>
<p>Suppose that the configured partitions are:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">part1</span></tt> which has a 1000GiB capacity, 400GiB being free (that is, 40% free space)</li>
<li><tt class="docutils literal"><span class="pre">part2</span></tt> which has a 1000GiB capacity, 600GiB being free (that is, 60% free space)</li>
<li><tt class="docutils literal"><span class="pre">part3</span></tt> which has a 100GiB capacity, 30GiB being free (that is, 30% free space)</li>
<li><tt class="docutils literal"><span class="pre">part4</span></tt> which has a 100GiB capacity, 70GiB being free (that is, 70% free space)</li>
</ul>
<p class="last">In that case <tt class="docutils literal"><span class="pre">part2</span></tt> will be selected as most fitting, since 600GiB of free space is the biggest of all partitions.</p>
</div>
<ul>
<li><p class="first">freespace-percent-most</p>
<blockquote>
<div><p>The partition which has the most percentage of free space is selected.</p>
</div></blockquote>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Example of ``freespace-percent-most`` Selection on Backend</strong></p>
<p class="last">In the same conditions, <tt class="docutils literal"><span class="pre">part4</span></tt> would be selected as most fitting, since 70% of free space is the biggest of all partitions.</p>
</div>
<ul>
<li><p class="first">freespace-percent-weighted</p>
<blockquote>
<div><p>For each partition, the percentage of free space is its weight. Then a weighted choice is performed to select one of those partitions.</p>
<p>As such, the more free space the partition has, the more chances it has to be selected.</p>
</div></blockquote>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Example of ``freespace-percent-weighted`` Selection on Backend</strong></p>
<p>In the same conditions, the weight of each partition would be:</p>
<ul class="simple">
<li>40 for <tt class="docutils literal"><span class="pre">part1</span></tt></li>
<li>60 for <tt class="docutils literal"><span class="pre">part2</span></tt></li>
<li>30 for <tt class="docutils literal"><span class="pre">part3</span></tt></li>
<li>70 for <tt class="docutils literal"><span class="pre">part4</span></tt></li>
</ul>
<p>The sum of each weight being 200, the probability for each partition to be selected as most fitting would be:</p>
<ul class="last simple">
<li>20% for <tt class="docutils literal"><span class="pre">part1</span></tt></li>
<li>30% for <tt class="docutils literal"><span class="pre">part2</span></tt></li>
<li>15% for <tt class="docutils literal"><span class="pre">part3</span></tt></li>
<li>35% for <tt class="docutils literal"><span class="pre">part4</span></tt></li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="usage-convergence">
<h1>Usage convergence<a class="headerlink" href="#usage-convergence" title="Permalink to this headline">¶</a></h1>
<p>In <tt class="docutils literal"><span class="pre">freespace-percent-weighted</span></tt> mode, partitions percentage usages converge towards 100%. So if they have different usages, those differences will stay and only really diminish upon reaching 100% of usage.</p>
<p>You may also observe growing differences between partitions usage when those partitions do not have the same total disk space.</p>
<ul class="simple">
<li>freespace-percent-weighted-delta</li>
</ul>
<p>As for <tt class="docutils literal"><span class="pre">freespace-percent-weighted</span></tt>, a weight is associated to each partition. It is computed as follows: (&lt;emphasis&gt;percentage of freespace of partition&lt;/emphasis&gt;) - (&lt;emphasis&gt;lowest percentage of freespace of all partitions&lt;/emphasis&gt;) + 0.5</p>
<p>Then a weighted choice is performed to select one of those partitions.</p>
<p>As such, considering the percentages of usage, the more the partition is lagging behind the most used partition (which is the one with the lowest percentage of free space), the more chances it has to be selected.</p>
</div>
<div class="section" id="computed-weight">
<h1>Computed weight<a class="headerlink" href="#computed-weight" title="Permalink to this headline">¶</a></h1>
<p>The added 0.5 in partitions weight is so that selection gets smoother when all partitions get close to each other.</p>
<p>&lt;example id=&#8221;exam-Deployment_Guide-Available_Selection_Modes_on_Backend-Example_of_freespace_percent_weighted_delta_Selection_on_Backend&#8221;&gt;</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Example of ``freespace-percent-weighted-delta`` Selection on Backend</strong></p>
<p>In the same conditions, the weight of each partition would be:</p>
<ul class="simple">
<li>40 - 30 + 0.5 = 10.5 for <tt class="docutils literal"><span class="pre">part1</span></tt></li>
<li>60 - 30 + 0.5 = 30.5 for <tt class="docutils literal"><span class="pre">part2</span></tt></li>
<li>30 - 30 + 0.5 = 0.5 for <tt class="docutils literal"><span class="pre">part3</span></tt></li>
<li>70 - 30 + 0.5 = 40.5 for <tt class="docutils literal"><span class="pre">part4</span></tt></li>
</ul>
<p>Then the probability for each partition to be selected as most fitting would be:</p>
<ul class="simple">
<li>12.8% for <tt class="docutils literal"><span class="pre">part1</span></tt></li>
<li>37.2% for <tt class="docutils literal"><span class="pre">part2</span></tt></li>
<li>0.6% for <tt class="docutils literal"><span class="pre">part3</span></tt></li>
<li>49.4% for <tt class="docutils literal"><span class="pre">part4</span></tt></li>
</ul>
<p class="last">In <tt class="docutils literal"><span class="pre">freespace-percent-weighted-delta</span></tt> mode, partitions percentage usages converge towards the most used one. And then partitions usages grow equally.</p>
</div>
</div>
<div class="section" id="special-cases">
<h1>Special cases<a class="headerlink" href="#special-cases" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-happens-when-two-partitions-are-equal-as-most-fitting">
<h2>What happens when two partitions are equal as most fitting?<a class="headerlink" href="#what-happens-when-two-partitions-are-equal-as-most-fitting" title="Permalink to this headline">¶</a></h2>
<p>Suppose you are using the <tt class="docutils literal"><span class="pre">freespace-most</span></tt> selection mode, that two (or more) partitions have the same free size, and that this freespace happens to be the biggest one of all configured partitions.</p>
<p>In that case, only one of those partitions will be selected. You may not know in advance which one will be: it depends of the order in which configured partitions are stored in memory (<tt class="docutils literal"><span class="pre">hashtable</span></tt>). In particular, it may not be the first one that appears listed in your <tt class="docutils literal"><span class="pre">/etc/imapd.conf</span></tt> configuration file.</p>
<p>Also note that since the selected partition will now have less free space, it shall not be seen as most fitting next time.</p>
</div>
<div class="section" id="what-happens-when-two-partitions-point-to-the-same-device">
<h2>What happens when two partitions point to the same device?<a class="headerlink" href="#what-happens-when-two-partitions-point-to-the-same-device" title="Permalink to this headline">¶</a></h2>
<p>Suppose you are using the <tt class="docutils literal"><span class="pre">freespace-most</span></tt> or <tt class="docutils literal"><span class="pre">freespace-percent-most</span></tt> selection mode, and that two (or more) partitions actually point to the same device (that is the device id is the same).</p>
<p>In that case, only one of those partitions will be checked, as if the others were not configured. You may not know in advance which one will be: it depends of the order in which configured partitions are stored in memory (&lt;emphasis&gt;hashtable&lt;/emphasis&gt;). In particular, it may not be the first one that appears listed in your &lt;filename&gt;/etc/imapd.conf&lt;/filename&gt; configuration file.</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;section id=&#8221;sect-Deployment_Guide-On_backend-Partitions_Exclusion&#8221;&gt;</dt>
<dd><p class="first">&lt;title&gt;Partitions Exclusion&lt;/title&gt;
&lt;para&gt;</p>
<blockquote>
<div>Partitions listed in the <tt class="docutils literal"><span class="pre">partition_mode_exclude</span></tt> setting are permanently excluded from being selected.</div></blockquote>
<p>&lt;/para&gt;
&lt;note&gt;</p>
<blockquote>
<div><p>&lt;title&gt;``partition_mode_exclude``&lt;/title&gt;
&lt;para&gt;</p>
<blockquote>
<div>Listed partitions names are separated by space or comma. Only configured partition names (and not paths) are expected.</div></blockquote>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p>&lt;/note&gt;
&lt;para&gt;</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>&lt;example id=&#8221;exam-Deployment_Guide-Partitions_Exclusion-Example_of_permanent_partition_exclusion&#8221;&gt;</dt>
<dd><p class="first">&lt;title&gt;Example of permanent partition exclusion&lt;/title&gt;
&lt;para&gt;</p>
<blockquote class="last">
<div>With the following configuration in &lt;filename&gt;/etc/imapd.conf&lt;/filename&gt;, <tt class="docutils literal"><span class="pre">parta</span></tt> and <tt class="docutils literal"><span class="pre">partb</span></tt> would be permanently excluded from being selected:</div></blockquote>
</dd>
</dl>
</div></blockquote>
</dd>
</dl>
</div></blockquote>
<p>&lt;screen&gt;
partition-part1: /path/to/part1
partition-part2: /path/to/part2
partition-part3: /path/to/part3
partition-part4: /path/to/part4
partition-parta: /path/to/parta
partition-partb: /path/to/partb</p>
<p>partition_mode_exclude: parta partb
&lt;/screen&gt;</p>
<blockquote>
<div><blockquote>
<div><blockquote>
<div><blockquote>
<div><blockquote>
<div>&lt;/para&gt;</div></blockquote>
<p>&lt;/example&gt;</p>
</div></blockquote>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div>When using a selection mode other than <tt class="docutils literal"><span class="pre">random</span></tt>, partitions are automatically excluded if their usage percentage is beyond the <tt class="docutils literal"><span class="pre">partition_mode_soft_usage_limit</span></tt> integer setting.</div></blockquote>
<p>&lt;/para&gt;
&lt;note&gt;</p>
<blockquote>
<div><p>&lt;title&gt;``partition_mode_soft_usage_limit``&lt;/title&gt;
&lt;para&gt;</p>
<blockquote>
<div>If all partitions are beyond the configured value, this feature is automatically deactivated. A partition is thus selected as if the setting was not set.</div></blockquote>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p>&lt;/note&gt;
&lt;para&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;example id=&#8221;exam-Deployment_Guide-Partitions_Exclusion-Example_of_partition_exclusion_using_partition_mode_soft_usage_limit&#8221;&gt;</dt>
<dd><p class="first">&lt;title&gt;Example of partition exclusion using <a href="#id1"><span class="problematic" id="id2">``</span></a>partition_mode_soft_usage_limit``&lt;/title&gt;
&lt;para&gt;</p>
<blockquote>
<div>In the same conditions than &lt;xref linkend=&#8221;exam-Deployment_Guide-Available_Selection_Modes_on_Backend-Example_of_freespace_most_Selection_on_Backend&#8221; /&gt;, setting <tt class="docutils literal"><span class="pre">partition_mode_soft_usage_limit</span></tt> to <tt class="docutils literal"><span class="pre">50</span></tt> would exclude partitions <tt class="docutils literal"><span class="pre">part1</span></tt> and <tt class="docutils literal"><span class="pre">part3</span></tt> since their disk usage is respectively 60% and 70%.</div></blockquote>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div>But setting the option to <tt class="docutils literal"><span class="pre">20</span></tt> would have no effect, since the usage of all partitions is beyond 20%.</div></blockquote>
<p class="last">&lt;/para&gt;</p>
</dd>
</dl>
<p>&lt;/example&gt;</p>
</div></blockquote>
<p>&lt;/para&gt;
&lt;important&gt;</p>
<blockquote>
<div><p>&lt;title&gt;Exclusion is not absolute&lt;/title&gt;
&lt;para&gt;</p>
<blockquote>
<div>Partitions are only excluded when creating a new user mailbox according to the configured selection mode.</div></blockquote>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div>If you explicitly specify an excluded partition, the mailbox will be created on that partition.</div></blockquote>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div>Mailboxes previously created on such partitions are of course still accessible, and subfolders are by default still created on the same partition as the parent folder.</div></blockquote>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p>&lt;/important&gt;</p>
</div></blockquote>
<p>&lt;/section&gt;</p>
<dl class="docutils">
<dt>&lt;section id=&#8221;sect-Deployment_Guide-On_backend-Partitions_Usage_Data_Reset&#8221;&gt;</dt>
<dd><p class="first">&lt;title&gt;Partitions Usage Data Reset&lt;/title&gt;
&lt;para&gt;</p>
<blockquote>
<div>By default partitions usage data are retrieved only once upon service initialization. This only concerns selection modes other than <tt class="docutils literal"><span class="pre">random</span></tt>.</div></blockquote>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div>If you tend to use the same service instance for a long lapse of time and performs a large amount of mailboxes creation, it may be useful to configure the <tt class="docutils literal"><span class="pre">partition_mode_usage_reinit</span></tt> so that partitions usage data are refreshed after the configured number of creation requests.</div></blockquote>
<p class="last">&lt;/para&gt;</p>
</dd>
</dl>
<p>&lt;/section&gt;</p>
</div></blockquote>
<p>&lt;/section&gt;</p>
<dl class="docutils">
<dt>&lt;section id=&#8221;sect-Deployment_Guide-Mailbox_Creation_Distribution-Through_murder_frontend&#8221;&gt;</dt>
<dd><p class="first">&lt;title&gt;Through &lt;emphasis&gt;murder frontend&lt;/emphasis&gt;&lt;/title&gt;
&lt;para&gt;</p>
<blockquote>
<div>Upon creating a user mailbox, if the target server is not given as extra parameter, the mailbox is either created on</div></blockquote>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;itemizedlist&gt;</dt>
<dd><dl class="first docutils">
<dt>&lt;listitem&gt;</dt>
<dd><dl class="first docutils">
<dt>&lt;para&gt;</dt>
<dd>the configured <tt class="docutils literal"><span class="pre">defaultserver</span></tt> backend</dd>
</dl>
<p class="last">&lt;/para&gt;</p>
</dd>
</dl>
<p>&lt;/listitem&gt;
&lt;listitem&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;para&gt;</dt>
<dd>the most fitting backend among the servers listed in the <tt class="docutils literal"><span class="pre">serverlist</span></tt> setting, if <tt class="docutils literal"><span class="pre">defaultserver</span></tt> is not configured</dd>
</dl>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p class="last">&lt;/listitem&gt;</p>
</dd>
</dl>
<p>&lt;/itemizedlist&gt;</p>
</div></blockquote>
<p>&lt;/para&gt;
&lt;section id=&#8221;sect-Deployment_Guide-Through_murder_frontend-Selection_Mode&#8221;&gt;</p>
<blockquote>
<div><p>&lt;title&gt;Selection Mode&lt;/title&gt;
&lt;para&gt;</p>
<blockquote>
<div>Among the backends, how the most fitting one is selected depends on the configured selection mode: <tt class="docutils literal"><span class="pre">serverlist_mode</span></tt> setting in &lt;filename&gt;/etc/imapd.conf&lt;/filename&gt;.</div></blockquote>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div>The principle is similar to the mailbox creation distribution on backend (see &lt;xref linkend=&#8221;sect-Deployment_Guide-Mailbox_Creation_Distribution-On_backend&#8221; /&gt;).</div></blockquote>
<p>&lt;/para&gt;
&lt;variablelist id=&#8221;vari-Deployment_Guide-Selection_Mode-Available_Selection_Modes_on_Frontend&#8221;&gt;</p>
<blockquote>
<div><p>&lt;title&gt;Available Selection Modes on Frontend&lt;/title&gt;
&lt;varlistentry&gt;</p>
<blockquote>
<div><p>&lt;term&gt;random&lt;/term&gt;
&lt;listitem&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;para&gt;</dt>
<dd>Choice is (pseudo-)random. Each backend has the same probability of being selected.</dd>
</dl>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p>&lt;/listitem&gt;</p>
</div></blockquote>
<p>&lt;/varlistentry&gt;
&lt;varlistentry&gt;</p>
<blockquote>
<div><p>&lt;term&gt;freespace-most&lt;/term&gt;
&lt;listitem&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;para&gt;</dt>
<dd>The backend which has the most free space (counted in KiB units) is selected. The considered free space is the sum of all available partitions free space on the backend.</dd>
</dl>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;example id=&#8221;exam-Deployment_Guide-Available_Selection_Modes_on_Frontend-Example_of_freespace_most_Selection_on_Frontend&#8221;&gt;</dt>
<dd><p class="first">&lt;title&gt;Example of <tt class="docutils literal"><span class="pre">freespace-most</span></tt> Selection on Frontend&lt;/title&gt;
&lt;para&gt;</p>
<blockquote>
<div>Suppose that the configured backends are:</div></blockquote>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;itemizedlist&gt;</dt>
<dd><dl class="first docutils">
<dt>&lt;listitem&gt;</dt>
<dd><dl class="first docutils">
<dt>&lt;para&gt;</dt>
<dd><tt class="docutils literal"><span class="pre">backend1</span></tt> which has a 2000GiB capacity, 1000GiB being free (that is, 50% free space), composed of 2 partitions</dd>
</dl>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;itemizedlist&gt;</dt>
<dd><dl class="first docutils">
<dt>&lt;listitem&gt;</dt>
<dd><dl class="first docutils">
<dt>&lt;para&gt;</dt>
<dd><tt class="docutils literal"><span class="pre">part1</span></tt> which has a 1000GiB capacity, 500GiB being free (that is, 50% free space)</dd>
</dl>
<p class="last">&lt;/para&gt;</p>
</dd>
</dl>
<p>&lt;/listitem&gt;
&lt;listitem&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;para&gt;</dt>
<dd><tt class="docutils literal"><span class="pre">part2</span></tt> which has a 1000GiB capacity, 500GiB being free (that is, 50% free space)</dd>
</dl>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p class="last">&lt;/listitem&gt;</p>
</dd>
</dl>
<p>&lt;/itemizedlist&gt;</p>
</div></blockquote>
<p class="last">&lt;/para&gt;</p>
</dd>
</dl>
<p>&lt;/listitem&gt;
&lt;listitem&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;para&gt;</dt>
<dd><tt class="docutils literal"><span class="pre">backend2</span></tt> which has a 2000GiB capacity, 900GiB being free (that is, 45% free space), composed of 2 partitions</dd>
</dl>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;itemizedlist&gt;</dt>
<dd><dl class="first docutils">
<dt>&lt;listitem&gt;</dt>
<dd><dl class="first docutils">
<dt>&lt;para&gt;</dt>
<dd><tt class="docutils literal"><span class="pre">part1</span></tt> which has a 1000GiB capacity, 200GiB being free (that is, 20% free space)</dd>
</dl>
<p class="last">&lt;/para&gt;</p>
</dd>
</dl>
<p>&lt;/listitem&gt;
&lt;listitem&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;para&gt;</dt>
<dd><tt class="docutils literal"><span class="pre">part2</span></tt> which has a 1000GiB capacity, 700GiB being free (that is, 70% free space)</dd>
</dl>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p class="last">&lt;/listitem&gt;</p>
</dd>
</dl>
<p>&lt;/itemizedlist&gt;</p>
</div></blockquote>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p>&lt;/listitem&gt;
&lt;listitem&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;para&gt;</dt>
<dd><tt class="docutils literal"><span class="pre">backend3</span></tt> which has a 200GiB capacity, 110GiB being free (that is, 55% free space), composed of 2 partitions</dd>
</dl>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;itemizedlist&gt;</dt>
<dd><dl class="first docutils">
<dt>&lt;listitem&gt;</dt>
<dd><dl class="first docutils">
<dt>&lt;para&gt;</dt>
<dd><tt class="docutils literal"><span class="pre">part1</span></tt> which has a 100GiB capacity, 30GiB being free (that is, 30% free space)</dd>
</dl>
<p class="last">&lt;/para&gt;</p>
</dd>
</dl>
<p>&lt;/listitem&gt;
&lt;listitem&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;para&gt;</dt>
<dd><tt class="docutils literal"><span class="pre">part2</span></tt> which has a 100GiB capacity, 80GiB being free (that is, 80% free space)</dd>
</dl>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p class="last">&lt;/listitem&gt;</p>
</dd>
</dl>
<p>&lt;/itemizedlist&gt;</p>
</div></blockquote>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p class="last">&lt;/listitem&gt;</p>
</dd>
</dl>
<p>&lt;/itemizedlist&gt;</p>
</div></blockquote>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div>In that case <tt class="docutils literal"><span class="pre">backend1</span></tt> will be selected as most fitting, since 1000GiB of free space is the biggest of all backends.</div></blockquote>
<p class="last">&lt;/para&gt;</p>
</dd>
</dl>
<p>&lt;/example&gt;</p>
</div></blockquote>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p>&lt;/listitem&gt;</p>
</div></blockquote>
<p>&lt;/varlistentry&gt;
&lt;varlistentry&gt;</p>
<blockquote>
<div><p>&lt;term&gt;freespace-percent-most&lt;/term&gt;
&lt;listitem&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;para&gt;</dt>
<dd>On each backend, the partition with the most percentage of free space is considered. The selected backend is the one whose partition has the most percentage of free space.</dd>
</dl>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;example id=&#8221;exam-Deployment_Guide-Available_Selection_Modes_on_Frontend-Example_of_freespace_percent_most_Selection_on_Frontend&#8221;&gt;</dt>
<dd><p class="first">&lt;title&gt;Example of <tt class="docutils literal"><span class="pre">freespace-percent-most</span></tt> Selection on Frontend&lt;/title&gt;
&lt;para&gt;</p>
<blockquote>
<div>In the same conditions than &lt;xref linkend=&#8221;exam-Deployment_Guide-Available_Selection_Modes_on_Frontend-Example_of_freespace_most_Selection_on_Frontend&#8221; /&gt; <tt class="docutils literal"><span class="pre">backend3</span></tt> would be selected as most fitting, since it has a partition with 80% of free space which is the biggest of all backends.</div></blockquote>
<p class="last">&lt;/para&gt;</p>
</dd>
</dl>
<p>&lt;/example&gt;</p>
</div></blockquote>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p>&lt;/listitem&gt;</p>
</div></blockquote>
<p>&lt;/varlistentry&gt;
&lt;varlistentry&gt;</p>
<blockquote>
<div><p>&lt;term&gt;freespace-percent-weighted&lt;/term&gt;
&lt;listitem&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;para&gt;</dt>
<dd>On each backend, the partition with the most percentage of free space is considered: it is the backend weight. Then a weighted choice is performed to select one of the backends.</dd>
</dl>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;example id=&#8221;exam-Deployment_Guide-Available_Selection_Modes_on_Frontend-Example_of_freespace_percent_weighted_Selection_on_Frontend&#8221;&gt;</dt>
<dd><p class="first">&lt;title&gt;Example of <tt class="docutils literal"><span class="pre">freespace-percent-weighted</span></tt> Selection on Frontend&lt;/title&gt;
&lt;para&gt;</p>
<blockquote>
<div>In the same conditions than &lt;xref linkend=&#8221;exam-Deployment_Guide-Available_Selection_Modes_on_Frontend-Example_of_freespace_most_Selection_on_Frontend&#8221; /&gt;, the weight of each backend would be:</div></blockquote>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;itemizedlist&gt;</dt>
<dd><dl class="first docutils">
<dt>&lt;listitem&gt;</dt>
<dd><dl class="first docutils">
<dt>&lt;para&gt;</dt>
<dd>50 for <tt class="docutils literal"><span class="pre">backend1</span></tt></dd>
</dl>
<p class="last">&lt;/para&gt;</p>
</dd>
</dl>
<p>&lt;/listitem&gt;
&lt;listitem&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;para&gt;</dt>
<dd>70 for <tt class="docutils literal"><span class="pre">backend2</span></tt></dd>
</dl>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p>&lt;/listitem&gt;
&lt;listitem&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;para&gt;</dt>
<dd>80 for <tt class="docutils literal"><span class="pre">backend3</span></tt></dd>
</dl>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p class="last">&lt;/listitem&gt;</p>
</dd>
</dl>
<p>&lt;/itemizedlist&gt;</p>
</div></blockquote>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div>The sum of each weight being 200, the probability for each backend to be selected as most fitting would be:</div></blockquote>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;itemizedlist&gt;</dt>
<dd><dl class="first docutils">
<dt>&lt;listitem&gt;</dt>
<dd><dl class="first docutils">
<dt>&lt;para&gt;</dt>
<dd>25% for <tt class="docutils literal"><span class="pre">backend1</span></tt></dd>
</dl>
<p class="last">&lt;/para&gt;</p>
</dd>
</dl>
<p>&lt;/listitem&gt;
&lt;listitem&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;para&gt;</dt>
<dd>35% for <tt class="docutils literal"><span class="pre">backend2</span></tt></dd>
</dl>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p>&lt;/listitem&gt;
&lt;listitem&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;para&gt;</dt>
<dd>40% for <tt class="docutils literal"><span class="pre">backend3</span></tt></dd>
</dl>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p class="last">&lt;/listitem&gt;</p>
</dd>
</dl>
<p>&lt;/itemizedlist&gt;</p>
</div></blockquote>
<p class="last">&lt;/para&gt;</p>
</dd>
</dl>
<p>&lt;/example&gt;</p>
</div></blockquote>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p>&lt;/listitem&gt;</p>
</div></blockquote>
<p>&lt;/varlistentry&gt;
&lt;varlistentry&gt;</p>
<blockquote>
<div><p>&lt;term&gt;freespace-percent-weighted-delta&lt;/term&gt;
&lt;listitem&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;para&gt;</dt>
<dd>On each backend, the partition with the most percentage of free space is considered. As for <tt class="docutils literal"><span class="pre">freespace-percent-weighted</span></tt>, a weight is associated to each backend. It is computed as follows: (&lt;emphasis&gt;percentage of freespace on backend&lt;/emphasis&gt;) - (&lt;emphasis&gt;lowest percentage of freespace of all backends&lt;/emphasis&gt;) + 0.5</dd>
</dl>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div>Then a weighted choice is performed to select one of the backends.</div></blockquote>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;example id=&#8221;exam-Deployment_Guide-Available_Selection_Modes_on_Frontend-Example_of_freespace_percent_weighted_delta_Selection_on_Frontend&#8221;&gt;</dt>
<dd><p class="first">&lt;title&gt;Example of <tt class="docutils literal"><span class="pre">freespace-percent-weighted-delta</span></tt> Selection on Frontend&lt;/title&gt;
&lt;para&gt;</p>
<blockquote>
<div>In the same conditions than &lt;xref linkend=&#8221;exam-Deployment_Guide-Available_Selection_Modes_on_Frontend-Example_of_freespace_most_Selection_on_Frontend&#8221; /&gt;, the weight of each backend would be:</div></blockquote>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;itemizedlist&gt;</dt>
<dd><dl class="first docutils">
<dt>&lt;listitem&gt;</dt>
<dd><dl class="first docutils">
<dt>&lt;para&gt;</dt>
<dd>50 - 50 + 0.5 = 0.5 for <tt class="docutils literal"><span class="pre">backend1</span></tt></dd>
</dl>
<p class="last">&lt;/para&gt;</p>
</dd>
</dl>
<p>&lt;/listitem&gt;
&lt;listitem&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;para&gt;</dt>
<dd>70 - 50 + 0.5 = 20.5 for <tt class="docutils literal"><span class="pre">backend2</span></tt></dd>
</dl>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p>&lt;/listitem&gt;
&lt;listitem&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;para&gt;</dt>
<dd>80 - 50 + 0.5 = 30.5 for <tt class="docutils literal"><span class="pre">backend3</span></tt></dd>
</dl>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p class="last">&lt;/listitem&gt;</p>
</dd>
</dl>
<p>&lt;/itemizedlist&gt;</p>
</div></blockquote>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div>Then the probability for each backend to be selected as most fitting would be:</div></blockquote>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;itemizedlist&gt;</dt>
<dd><dl class="first docutils">
<dt>&lt;listitem&gt;</dt>
<dd><dl class="first docutils">
<dt>&lt;para&gt;</dt>
<dd>1.0% for <tt class="docutils literal"><span class="pre">backend1</span></tt></dd>
</dl>
<p class="last">&lt;/para&gt;</p>
</dd>
</dl>
<p>&lt;/listitem&gt;
&lt;listitem&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;para&gt;</dt>
<dd>39.8% for <tt class="docutils literal"><span class="pre">backend2</span></tt></dd>
</dl>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p>&lt;/listitem&gt;
&lt;listitem&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;para&gt;</dt>
<dd>59.2% for <tt class="docutils literal"><span class="pre">backend3</span></tt></dd>
</dl>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p class="last">&lt;/listitem&gt;</p>
</dd>
</dl>
<p>&lt;/itemizedlist&gt;</p>
</div></blockquote>
<p class="last">&lt;/para&gt;</p>
</dd>
</dl>
<p>&lt;/example&gt;</p>
</div></blockquote>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p>&lt;/listitem&gt;</p>
</div></blockquote>
<p>&lt;/varlistentry&gt;</p>
</div></blockquote>
<p>&lt;/variablelist&gt;</p>
</div></blockquote>
<p>&lt;/section&gt;</p>
<dl class="docutils">
<dt>&lt;section id=&#8221;sect-Deployment_Guide-Through_murder_frontend-Backends_Exclusion&#8221;&gt;</dt>
<dd><p class="first">&lt;title&gt;Backends Exclusion&lt;/title&gt;
&lt;para&gt;</p>
<blockquote>
<div>When using a selection mode other than <tt class="docutils literal"><span class="pre">random</span></tt>, backends are automatically excluded if their considered usage percentage is beyond the <tt class="docutils literal"><span class="pre">serverlist_mode_soft_usage_limit</span></tt> integer setting.</div></blockquote>
<p>&lt;/para&gt;
&lt;note&gt;</p>
<blockquote>
<div><p>&lt;title&gt;``partition_mode_soft_usage_limit``&lt;/title&gt;
&lt;para&gt;</p>
<blockquote>
<div>If all backends are beyond the configured value, this feature is automatically deactivated. A backend is thus selected as if the setting was not set.</div></blockquote>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p>&lt;/note&gt;
&lt;para&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>&lt;example id=&#8221;exam-Deployment_Guide-Backends_Exclusion-Example_of_partition_exclusion_using_serverlist_mode_soft_usage_limit&#8221;&gt;</dt>
<dd><p class="first">&lt;title&gt;Example of partition exclusion using <a href="#id3"><span class="problematic" id="id4">``</span></a>serverlist_mode_soft_usage_limit``&lt;/title&gt;
&lt;para&gt;</p>
<blockquote>
<div>In the same conditions than &lt;xref linkend=&#8221;exam-Deployment_Guide-Available_Selection_Modes_on_Frontend-Example_of_freespace_most_Selection_on_Frontend&#8221; /&gt;, using <tt class="docutils literal"><span class="pre">freespace-most</span></tt> selection mode, setting <tt class="docutils literal"><span class="pre">serverlist_mode_soft_usage_limit</span></tt> to <tt class="docutils literal"><span class="pre">49</span></tt> would exclude <tt class="docutils literal"><span class="pre">backend1</span></tt> and <tt class="docutils literal"><span class="pre">backend2</span></tt> since in that mode they have a disk usage of 50% and 55%. In other modes it would however only exclude <tt class="docutils literal"><span class="pre">backend1</span></tt> whose considered partition has a disk usage of 50%, while on <tt class="docutils literal"><span class="pre">backend2</span></tt> the considered partition has a disk usage of 30%.</div></blockquote>
<p class="last">&lt;/para&gt;</p>
</dd>
</dl>
<p>&lt;/example&gt;</p>
</div></blockquote>
<p>&lt;/para&gt;
&lt;important&gt;</p>
<blockquote>
<div><p>&lt;title&gt;Exclusion is not absolute&lt;/title&gt;
&lt;para&gt;</p>
<blockquote>
<div>Backends are only excluded when creating a new user mailbox according to the configured selection mode.</div></blockquote>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div>If you explicitly specify an excluded backend, the mailbox will be created on that backend.</div></blockquote>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div>Mailboxes previously created on such backends are of course still accessible.</div></blockquote>
<p>&lt;/para&gt;</p>
</div></blockquote>
<p class="last">&lt;/important&gt;</p>
</dd>
</dl>
<p>&lt;/section&gt;</p>
<dl class="docutils">
<dt>&lt;section id=&#8221;sect-Deployment_Guide-Through_murder_frontend-Backends_Usage_Data_Reset&#8221;&gt;</dt>
<dd><p class="first">&lt;title&gt;Backends Usage Data Reset&lt;/title&gt;
&lt;para&gt;</p>
<blockquote>
<div>By default backends usage data are retrieved only once upon service initialization. This only concerns selection modes other than <tt class="docutils literal"><span class="pre">random</span></tt>.</div></blockquote>
<p>&lt;/para&gt;
&lt;para&gt;</p>
<blockquote>
<div>If you tend to use the same service instance for a long lapse of time and performs a large amount of mailboxes creation, it may be useful to configure the <tt class="docutils literal"><span class="pre">serverlist_mode_usage_reinit</span></tt> so that backends usage data are refreshed after the configured number of creation requests.</div></blockquote>
<p class="last">&lt;/para&gt;</p>
</dd>
</dl>
<p class="last">&lt;/section&gt;</p>
</dd>
</dl>
<p>&lt;/section&gt;</p>
</div></blockquote>
<p>&lt;/chapter&gt;</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Mailbox Creation Distribution</a><ul>
<li><a class="reference internal" href="#on-backend">On backend</a></li>
<li><a class="reference internal" href="#selection-mode">Selection Mode</a><ul>
<li><a class="reference internal" href="#available-selection-modes-on-backend">Available Selection Modes on Backend</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#usage-convergence">Usage convergence</a></li>
<li><a class="reference internal" href="#computed-weight">Computed weight</a></li>
<li><a class="reference internal" href="#special-cases">Special cases</a><ul>
<li><a class="reference internal" href="#what-happens-when-two-partitions-are-equal-as-most-fitting">What happens when two partitions are equal as most fitting?</a></li>
<li><a class="reference internal" href="#what-happens-when-two-partitions-point-to-the-same-device">What happens when two partitions point to the same device?</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="deployment_scenarios.html"
                        title="previous chapter">Deployment Scenarios</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="known_protocol_limitations.html"
                        title="next chapter">Known Protocol Limitations</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/deployment/mailbox_creation_distribution.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="known_protocol_limitations.html" title="Known Protocol Limitations"
             >next</a> |</li>
        <li class="right" >
          <a href="deployment_scenarios.html" title="Deployment Scenarios"
             >previous</a> |</li>
        <li><a href="../index.html">Cyrus IMAP and SASL 2.4 documentation</a> &raquo;</li>
          <li><a href="index.html" >Deployment Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 1993-2014, The Cyrus Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>